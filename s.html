<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>STERLA - Integrated Mindmap + ChatGPT</title>
<style>
  :root {
    --black: #0b0b0d;
    --card: #111216;
    --light-blue: #84d2ff;
    --light-purple: #c2b3ff;
    --muted: #9aa0b4;
    --white: #ffffff;
    --success: #3cd48b;
    --danger: #e55a5a;
  }
  * {
    box-sizing: border-box;
    font-family: Inter, Poppins, system-ui, sans-serif;
  }
  html, body {
    height: 100%;
    margin: 0;
    background: linear-gradient(180deg, #0b0b0d 0%, #0f1724 100%);
    color: var(--white);
  }
  #loginPage {
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
  }
  .login-card {
    background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
    padding: 28px;
    border-radius: 20px;
    width: 360px;
    box-shadow: 0 12px 40px rgba(0,0,0,0.6);
    border: 1px solid rgba(255,255,255,0.03);
  }
  .login-card h2 {
    margin-bottom: 8px;
    color: var(--light-purple);
  }
  .login-card p {
    color: var(--muted);
    margin-bottom: 16px;
  }
  .input {
    width: 100%;
    padding: 12px;
    border-radius: 12px;
    border: none;
    margin: 8px 0;
    background: rgba(255,255,255,0.03);
    color: var(--white);
    outline: none;
  }
  .btn {
    width: 100%;
    padding: 12px;
    border-radius: 12px;
    border: none;
    background: linear-gradient(90deg, var(--light-blue), var(--light-purple));
    color: #001;
    cursor: pointer;
    font-weight: 700;
  }
  .small-btn {
    padding: 8px 12px;
    border-radius: 10px;
    border: none;
    background: transparent;
    color: var(--light-blue);
    cursor: pointer;
  }
  #appPage {
    display: none;
    height: 100vh;
    display: flex;
    overflow: hidden;
  }
  #sidebar {
    width: 260px;
    background: linear-gradient(180deg, #071028, #0b1633);
    padding: 28px;
    color: var(--white);
    border-right: 1px solid rgba(255,255,255,0.03);
    display: flex;
    flex-direction: column;
    gap: 14px;
  }
  .brand {
    font-size: 28px;
    font-weight: 800;
    color: var(--light-purple);
    letter-spacing: 1px;
  }
  .nav-btn {
    background: transparent;
    border: none;
    color: var(--muted);
    padding: 12px 14px;
    text-align: left;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 700;
  }
  .nav-btn.active,
  .nav-btn:hover {
    background: rgba(255,255,255,0.02);
    color: var(--white);
    box-shadow: 0 6px 20px rgba(124, 107, 255, 0.08);
  }
  #main {
    flex: 1;
    overflow: auto;
    padding: 30px;
    background: linear-gradient(180deg, #0b0f1a 0%, #0b1220 30%);
  }
  #welcomeBox {
    background: linear-gradient(180deg, #071028, #0b1430);
    border-radius: 16px;
    padding: 26px;
    color: var(--white);
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 20px;
  }
  #welcomeBox h2 {
    color: var(--light-blue);
    font-size: 22px;
    margin: 0;
  }
  #welcomeBox p {
    margin: 0;
    color: var(--muted);
  }
  .subject-grid {
    margin-top: 18px;
    display: flex;
    flex-wrap: wrap;
    gap: 18px;
  }
  .subject-card {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    padding: 20px;
    border-radius: 14px;
    width: 200px;
    cursor: pointer;
    box-shadow: 0 10px 30px rgba(2,6,23,0.6);
    border: 1px solid rgba(255,255,255,0.02);
    font-weight: 800;
    color: var(--light-blue);
    text-align: center;
  }
  .subject-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 18px 50px rgba(6,10,40,0.8);
  }
  .page {
    display: none;
  }
  .page.active {
    display: block;
  }
  .output-box {
    background: linear-gradient(180deg, #061022, #081428);
    padding: 18px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.02);
    color: var(--white);
  }
  #mindmapContainer {
    position: relative;
    background: linear-gradient(180deg, #071427, #02101a);
    border-radius: 14px;
    padding: 12px;
    min-height: 420px;
    overflow: auto;
    border: 1px solid rgba(255,255,255,0.03);
  }
  .mm-node {
    position: absolute;
    padding: 10px 14px;
    border-radius: 10px;
    background: #071f35;
    border: 2px solid rgba(132,210,255,0.15);
    cursor: grab;
    color: var(--white);
    min-width: 110px;
    text-align: center;
    box-shadow: 0 10px 24px rgba(2,6,23,0.6);
  }
  .mm-node:active {
    cursor: grabbing;
  }
  #connectionsSvg {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }
  #chatBox {
    background: #061025;
    padding: 12px;
    border-radius: 12px;
    min-height: 360px;
    max-height: 520px;
    overflow: auto;
    border: 1px solid rgba(255,255,255,0.02);
  }
  .chat-line {
    margin-bottom: 12px;
  }
  .chat-user {
    color: var(--light-blue);
    font-weight: 700;
  }
  .chat-ai {
    color: var(--light-purple);
    font-weight: 700;
  }
  .chat-input {
    margin-top: 12px;
    display: flex;
    gap: 12px;
  }
  .chat-input input {
    flex: 1;
    padding: 12px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.04);
    background: transparent;
    color: var(--white);
  }
  .chat-input button {
    padding: 10px 16px;
    border-radius: 10px;
    border: none;
    background: linear-gradient(90deg, var(--light-blue), var(--light-purple));
    color: #001;
    font-weight: 800;
  }
  .toast {
    position: fixed;
    left: 50%;
    transform: translateX(-50%);
    bottom: 26px;
    padding: 10px 18px;
    border-radius: 999px;
    font-weight: 700;
  }
  .toast.success {
    background: var(--success);
    color: #000;
  }
  .toast.error {
    background: var(--danger);
    color: #fff;
  }
  @media (max-width:900px) {
    #sidebar {
      display: none;
    }
    #main {
      padding: 18px;
    }
  }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginPage">
  <div class="login-card" role="dialog" aria-labelledby="loginTitle">
    <h2 id="loginTitle">STERLA</h2>
    <p>Select your role to continue</p>
    <select id="roleSelect" class="input">
      <option value="">Choose role</option>
      <option value="Student">Student</option>
      <option value="Teacher">Teacher</option>
    </select>
    <button class="btn" onclick="onLogin()">Login</button>
    <p id="loginMessage" style="color:var(--danger);min-height:18px"></p>
    <div style="margin-top:10px;display:flex;gap:8px;justify-content:center">
      <button class="small-btn" onclick="onLogin(true)">Continue as Guest</button>
    </div>
  </div>
</div>

<!-- APP -->
<div id="appPage" aria-live="polite">
  <aside id="sidebar" role="navigation">
    <div class="brand">STERLA</div>
    <button class="nav-btn active" data-page="homePage" onclick="navigate(event)">Home</button>
    <button class="nav-btn" data-page="subjectsPage" onclick="navigate(event)">Subjects</button>
    <button class="nav-btn" data-page="topicPage" onclick="navigate(event)">Topics</button>
    <button class="nav-btn" data-page="mindmapPage" onclick="navigate(event)">Mind Map</button>
    <button class="nav-btn" data-page="quizPage" onclick="navigate(event)">Quiz</button>
    <button class="nav-btn" data-page="wsPage" onclick="navigate(event)">Worksheet</button>
    <button class="nav-btn" data-page="aiChatPage" onclick="navigate(event)">AI Chat</button>
    <div style="flex:1"></div>
    <div style="font-size:12px;color:var(--muted)">Tip: Login to unlock AI features.</div>
  </aside>

  <main id="main">
    <section id="homePage" class="page active">
      <div id="welcomeBox">
        <div>
          <h2>Welcome to STERLA</h2>
          <p>Your learning companion â€” choose a subject and topic to get started.</p>
        </div>
        <div style="text-align:right;color:var(--muted)">
          <div id="welcomeUser">Guest</div>
          <div style="font-size:12px;margin-top:6px">Smart School Companion</div>
        </div>
      </div>
      <h3 style="color:var(--light-blue);margin-top:8px">Quick Subjects</h3>
      <div class="subject-grid" id="subjectsQuick"></div>
    </section>

    <section id="subjectsPage" class="page"><div id="subjectList" class="subject-grid"></div></section>
    <section id="topicPage" class="page"><div id="topicList" class="subject-grid"></div></section>
    <section id="mindmapPage" class="page"><div id="mindmapContainer"><svg id="connectionsSvg"></svg></div></section>
    <section id="quizPage" class="page"><div id="quizOutput" class="output-box"></div></section>
    <section id="wsPage" class="page"><div id="wsOutput" class="output-box"></div></section>
    <section id="aiChatPage" class="page">
      <div id="chatBox"></div>
      <div class="chat-input">
        <input type="text" id="chatInput" placeholder="Ask AI about this topic..." />
        <button onclick="sendMessage()">Send</button>
      </div>
    </section>
  </main>
</div>

<div id="toast" class="toast" style="display:none"></div>

<script>
  let userName = null;
  let userRole = null;
  let selectedSubject = '';
  let chosenTopic = '';

  // Subject list - predefined
  const subjects = [
    "Grammar","Formal Letter","Speech","Prose","Algebra","Linear Equations",
    "Mensuration","Reproduction in Animals","Sound","Electricity","1857 Revolt",
    "Resources","Judiciary","Vyakaran","Patra Lekhan","HTML","AI Basics",
    "Shabd Roop","Dhatu Roop","French Grammar","Culture","Networks","Cybersecurity"
  ];

  // Topics for each subject (simplified example)
  const topics = {
    "Grammar": ["Nouns", "Verbs", "Adjectives"],
    "Formal Letter": ["Letter Format", "Salutation", "Closing"],
    "Speech": ["Introduction", "Body", "Conclusion"],
    "Prose": ["Definition", "Examples", "Characteristics"],
    "Algebra": ["Basics", "Expressions", "Equations"],
    "Linear Equations": ["Graphing", "Solving", "Applications"],
    "Mensuration": ["Area", "Volume", "Surface Area"],
    "Reproduction in Animals": ["Sexual", "Asexual", "Fertilization"],
    "Sound": ["Properties", "Speed", "Uses"],
    "Electricity": ["Circuits", "Ohm's Law", "Safety"],
    "1857 Revolt": ["Causes", "Events", "Leaders"],
    "Resources": ["Renewable", "Non-renewable", "Conservation"],
    "Judiciary": ["Courts", "Judges", "Laws"],
    "Vyakaran": ["Sandhi", "Samas", "Tenses"],
    "Patra Lekhan": ["Formal", "Informal", "Formats"],
    "HTML": ["Tags", "Attributes", "Elements"],
    "AI Basics": ["Definitions", "Applications", "Types"],
    "Shabd Roop": ["Singular", "Plural", "Cases"],
    "Dhatu Roop": ["Verb Roots", "Conjugations", "Tenses"],
    "French Grammar": ["Nouns", "Verbs", "Adjectives"],
    "Culture": ["Food", "Art", "Traditions"],
    "Networks": ["LAN", "WAN", "Protocols"],
    "Cybersecurity": ["Threats", "Protection", "Tools"]
  };

  // Login function with validation and UI update
  function onLogin(guest = false) {
    const msg = document.getElementById('loginMessage');
    msg.textContent = '';

    if (!guest) {
      const role = document.getElementById('roleSelect').value;
      if (!role) {
        msg.textContent = 'Select Student or Teacher';
        return;
      }
      userName = role + ' User';
      userRole = role;
    } else {
      userName = 'Guest';
      userRole = 'Guest';
    }

    // Hide login page, show app
    document.getElementById('loginPage').style.display = 'none';
    document.getElementById('appPage').style.display = 'flex';

    // Update user display
    document.getElementById('welcomeUser').innerText = userName;

    // Load quick subjects on home page
    loadSubjects();
  }

  // Load quick subjects on home page for user to pick
  function loadSubjects() {
    const quick = document.getElementById('subjectsQuick');
    quick.innerHTML = '';
    subjects.forEach(sub => {
      const btn = document.createElement('button');
      btn.className = 'subject-card';
      btn.innerText = sub;
      btn.onclick = () => {
        selectedSubject = sub;
        renderTopics();
        navigate({currentTarget: document.querySelector('[data-page="topicPage"]')});
      };
      quick.appendChild(btn);
    });
  }

  // Navigation between app pages
  function navigate(e) {
    const btn = e.currentTarget;
    document.querySelectorAll('#sidebar .nav-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const page = btn.getAttribute('data-page');
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(page).classList.add('active');

    if (page === 'subjectsPage') loadSubjects();
    if (page === 'topicPage') renderTopics();
  }

  // Render topics of selected subject
  function renderTopics() {
    const list = document.getElementById('topicList');
    list.innerHTML = '';
    if (!selectedSubject || !topics[selectedSubject]) return;
    topics[selectedSubject].forEach(t => {
      const btn = document.createElement('button');
      btn.className = 'subject-card';
      btn.innerText = t;
      btn.onclick = () => {
        chosenTopic = t;
        loadMindmap();
        loadQuiz();
        loadWorksheet();
        navigate({currentTarget: document.querySelector('[data-page="mindmapPage"]')});
      };
      list.appendChild(btn);
    });
  }

  // Load mindmap for chosen topic (basic example)
  function loadMindmap() {
    const container = document.getElementById('mindmapContainer');
    container.innerHTML = '<svg id="connectionsSvg"></svg>';
    const node = document.createElement('div');
    node.className = 'mm-node';
    node.style.left = '50px';
    node.style.top = '50px';
    node.innerText = chosenTopic;
    container.appendChild(node);

    node.onmousedown = function (e) {
      let shiftX = e.clientX - node.getBoundingClientRect().left;
      let shiftY = e.clientY - node.getBoundingClientRect().top;
      function moveAt(pageX, pageY) {
        node.style.left = pageX - shiftX + 'px';
        node.style.top = pageY - shiftY + 'px';
      }
      function onMouseMove(e) {
        moveAt(e.pageX, e.pageY);
      }
      document.addEventListener('mousemove', onMouseMove);
      node.onmouseup = function () {
        document.removeEventListener('mousemove', onMouseMove);
        node.onmouseup = null;
      };
    };
    node.ondragstart = function () {
      return false;
    };
  }

  // Placeholder function loadQuiz
  function loadQuiz() {
    const out = document.getElementById('quizOutput');
    out.innerHTML = 'Quiz not available.';
  }

  // Placeholder function loadWorksheet
  function loadWorksheet() {
    const out = document.getElementById('wsOutput');
    out.innerHTML = 'Worksheet not available.';
  }

  // Simple AI chat answering based on topic - default fallback
  const aiBank = {
    "Grammar": [{q:"noun",a:"A noun is a person, place, thing, or idea."},{q:"verb",a:"A verb is an action or state of being."}],
    "Formal Letter": [{q:"formal",a:"A formal letter is written in a professional tone for official purposes."}],
    "Speech": [{q:"speech",a:"A speech is a talk delivered to an audience with a clear structure."}],
    "Prose": [{q:"prose",a:"Prose is ordinary written language without metrical structure."}],
    "Algebra": [{q:"solve",a:"To solve x+5=12 subtract 5 from both sides so x=7."}],
    "Linear Equations": [{q:"linear",a:"A linear equation has variables to the power 1 and graphs as a straight line."}],
    "Mensuration": [{q:"area",a:"Mensuration includes area, perimeter and volume formulas for shapes."}],
    "Reproduction in Animals": [{q:"reproduction",a:"Reproduction produces new organisms; types include sexual and asexual."}],
    "Sound": [{q:"sound",a:"Sound is a vibration that travels through a medium."}],
    "Electricity": [{q:"electricity",a:"Electricity is the flow of electric charge; V = IR (Ohm's law)."}],
    "1857 Revolt": [{q:"1857",a:"The 1857 Revolt was a large-scale uprising against British rule in India."}],
    "Resources": [{q:"resources",a:"Resources are materials (renewable or non-renewable) used by humans."}],
    "Judiciary": [{q:"judiciary",a:"The judiciary interprets and applies the law through courts."}],
    "Vyakaran": [{q:"vyakaran",a:"Vyakaran means grammar in Hindi; it covers rules of language."}],
    "Patra Lekhan": [{q:"patra",a:"Patra Lekhan is letter-writing in Hindi, formal or informal formats."}],
    "HTML": [{q:"html",a:"HTML structures web content using tags like <p>, <h1>, <a>."}],
    "AI Basics": [{q:"ai",a:"AI is the simulation of human intelligence in machines."}],
    "Shabd Roop": [{q:"shabd",a:"Shabd Roop studies different forms of words in Sanskrit."}],
    "Dhatu Roop": [{q:"dhatu",a:"Dhatu Roop deals with verb root forms and their conjugations."}],
    "French Grammar": [{q:"french",a:"French grammar covers articles, nouns, adjectives, and verb conjugations."}],
    "Culture": [{q:"culture",a:"French culture includes food, art, festivals, and social etiquette."}],
    "Networks": [{q:"networks",a:"Networks connect devices so they can share data and resources."}],
    "Cybersecurity": [{q:"cyber",a:"Cybersecurity protects systems and data from digital threats."}]
  };

  // Send message to AI chat with simple matching
  function sendMessage() {
    const input = document.getElementById('chatInput');
    let msg = input.value.trim();
    if (!msg) return;
    input.value = '';
    const chat = document.getElementById('chatBox');
    chat.innerHTML += '<div><b>You:</b> ' + msg + '</div>';
    let reply = 'Sorry, I don\'t know the answer.';
    if (chosenTopic && aiBank[chosenTopic]) {
      const match = aiBank[chosenTopic].find(o => msg.toLowerCase().includes(o.q.toLowerCase()));
      reply = match ? match.a : aiBank[chosenTopic][0].a;
    } else if (!chosenTopic) {
      reply = 'Select a topic first.';
    }
    chat.innerHTML += '<div><b>AI:</b> ' + reply + '</div>';
    chat.scrollTop = chat.scrollHeight;
  }

  // Toast notification function
  function showToast(msg, type) {
    const t = document.getElementById('toast');
    t.innerText = msg;
    t.className = 'toast ' + type;
    t.style.display = 'block';
    setTimeout(() => { t.style.display = 'none'; }, 2500);
  }
</script>
</body>
</html>
