<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>STERLA</title>
<style>
  :root {
    --black: #121212;
    --light-blue: #574b90;
    --light-purple: #8a7cc1;
    --white: #f0f0f0;
    --accent: #0099ff;
    --background-gradient: linear-gradient(135deg, var(--light-blue), var(--light-purple));
  }
  * {
    margin: 0; padding: 0; box-sizing: border-box;
    font-family: 'Poppins', sans-serif;
  }
  html, body {
    height: 100%;
    background: var(--black);
    color: var(--white);
  }
  #loginPage {
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: var(--background-gradient);
    flex-direction: column;
  }
  .login-container {
    background: rgba(255 255 255 / 0.1);
    padding: 30px 40px;
    border-radius: 12px;
    box-shadow: 0 0 30px rgba(138,124,193,0.5);
    width: 320px;
    text-align: center;
    color: var(--white);
  }
  .login-container h2 {
    margin-bottom: 20px;
    font-weight: 700;
    font-size: 28px;
  }
  .login-container input {
    width: 100%;
    padding: 12px 14px;
    margin-bottom: 15px;
    border-radius: 8px;
    border: none;
    background: rgba(255 255 255 / 0.15);
    color: var(--white);
    font-size: 16px;
  }
  .login-container input::placeholder {
    color: rgba(255 255 255 / 0.7);
  }
  .login-container button {
    padding: 12px 0;
    width: 100%;
    background: var(--accent);
    border: none;
    border-radius: 8px;
    font-size: 18px;
    color: var(--white);
    cursor: pointer;
    font-weight: 600;
    transition: background 0.3s ease;
  }
  .login-container button:hover {
    background: #0077cc;
  }
  #loginMessage {
    margin-top: 10px;
    font-size: 14px;
    height: 18px;
  }
  .social-login {
    margin-top: 25px;
  }
  .social-btn {
    background: transparent;
    border: 2px solid var(--white);
    color: var(--white);
    border-radius: 8px;
    padding: 10px 20px;
    cursor: pointer;
    margin: 8px 10px 0 0;
    font-weight: 600;
    font-size: 16px;
    transition: background 0.3s ease, color 0.3s ease;
  }
  .social-btn:hover {
    background: var(--white);
    color: var(--black);
  }
  .or-text {
    margin: 20px 0 10px;
    font-weight: 600;
    font-size: 18px;
  }

  /* APP PAGE */
  #appPage {
    display: none;
    height: 100vh;
    width: 100%;
    display: flex;
    background: var(--background-gradient);
  }
  #sidebar {
    width: 260px;
    background: var(--light-blue);
    padding: 30px 20px;
    color: var(--white);
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  #sidebar h2 {
    font-size: 28px;
    margin-bottom: 25px;
  }
  .nav-btn {
    background: transparent;
    color: var(--white);
    border: none;
    padding: 14px 18px;
    border-radius: 12px;
    font-size: 18px;
    text-align: left;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  .nav-btn:hover {
    background: var(--light-purple);
  }
  #main {
    flex-grow: 1;
    padding: 36px 40px;
    overflow-y: auto;
    color: var(--white);
  }
  .page {
    display: none;
  }
  .page.active {
    display: block;
  }

  /* Welcome Box */
  #welcomeBox {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(138,124,193,0.3);
    border-radius: 18px;
    padding: 40px;
    margin-bottom: 25px;
  }
  #welcomeBox h2 {
    font-size: 36px;
    max-width: 60%;
  }
  #welcomeBox p {
    font-size: 20px;
    margin-top: 12px;
    max-width: 60%;
  }
  #welcomeBox img {
    width: 180px;
    filter: drop-shadow(0 0 6px rgba(0,0,0,0.4));
  }

  /* Subject Cards */
  .subject-card {
    padding: 20px;
    margin: 15px 14px;
    background: var(--black);
    border-radius: 18px;
    border: 2px solid var(--light-purple);
    width: 170px;
    text-align: center;
    cursor: pointer;
    user-select: none;
    font-weight: 600;
    font-size: 20px;
    color: var(--white);
    transition: background 0.3s ease, color 0.3s ease;
  }
  .subject-card:hover {
    background: var(--light-purple);
    color: var(--black);
  }

  /* Topic Buttons */
  .topic-btn {
    padding: 14px 20px;
    margin: 8px 6px;
    border-radius: 18px;
    background: var(--light-purple);
    color: var(--white);
    font-size: 18px;
    cursor: pointer;
    border: none;
    user-select: none;
    transition: background 0.3s ease;
  }
  .topic-btn:hover {
    background: var(--accent);
  }

  /* Output Boxes */
  .output-box {
    background: rgba(255 255 255 / 0.15);
    border-radius: 16px;
    padding: 28px;
    min-height: 260px;
    font-size: 18px;
    line-height: 1.5;
  }
  .announce {
    background: rgba(138,124,193,0.2);
    padding: 14px 18px;
    border-radius: 14px;
    margin-bottom: 14px;
  }

  /* Chat */
  #chatBox {
    background: rgba(255 255 255 / 0.15);
    padding: 18px;
    border-radius: 14px;
    height: 430px;
    overflow-y: auto;
    margin-bottom: 12px;
    font-size: 16px;
  }
  #chatBox div {
    margin-bottom: 10px;
  }
  #chatInput {
    padding: 15px;
    border-radius: 12px;
    border: none;
    width: 80%;
    font-size: 18px;
    background: rgba(255 255 255 / 0.15);
    color: var(--white);
  }
  #chatInput::placeholder {
    color: rgba(255 255 255 / 0.6);
  }
  #chatBtn {
    background: var(--accent);
    border: none;
    color: white;
    font-size: 18px;
    padding: 15px 28px;
    border-radius: 12px;
    cursor: pointer;
    margin-left: 10px;
    font-weight: 600;
  }
  #chatBtn:hover {
    background: #0077cc;
  }

  /* Mindmap */
  #flowArea {
    background: rgba(255 255 255 / 0.15);
    border-radius: 14px;
    border: 2px solid var(--light-purple);
    margin-top: 20px;
    position: relative;
    overflow: auto;
    width: 100%;
    height: 600px;
  }
  svg {
    user-select: none;
  }

  /* Toast */
  .toast {
    position: fixed;
    left: 50%;
    transform: translateX(-50%);
    bottom: 40px;
    padding: 14px 26px;
    border-radius: 14px;
    color: white;
    font-weight: 600;
    font-size: 18px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    z-index: 9999;
    animation: fadein 0.3s, fadeout 0.3s 1.2s;
  }
  .toast-success {background: #28a745;}
  .toast-error {background: #dc3545;}
  @keyframes fadein {from {opacity: 0;} to {opacity: 1;}}
  @keyframes fadeout {from {opacity: 1;} to {opacity: 0;}}
</style>
</head>
<body>

<div id="loginPage">
  <div class="login-container" role="main" aria-label="Login form">
    <h2>Enter your email to sign in</h2>
    <input type="email" id="email" placeholder="Enter Email" aria-label="Email" />
    <input type="password" id="passcode" placeholder="Enter Passcode" aria-label="Passcode" />
    <button aria-label="Login with Email and Passcode" onclick="login()">Login</button>
    <p id="loginMessage" role="alert"></p>
    <div class="or-text" aria-hidden="true">OR</div>
    <div class="social-login" role="region" aria-label="Social Sign up options">
      <button class="social-btn" onclick="alert('Google sign-up integration not implemented')"
        aria-label="Sign up with Google">Sign up with Google</button>
      <button class="social-btn" onclick="alert('Facebook sign-up integration not implemented')"
        aria-label="Sign up with Facebook">Sign up with Facebook</button>
      <button class="social-btn" onclick="alert('Phone number sign-up integration not implemented')"
        aria-label="Sign up with Phone Number">Sign up with Phone Number</button>
    </div>
  </div>
</div>

<div id="appPage" role="main">
  <nav id="sidebar" aria-label="Main navigation">
    <h2>STERLA</h2>
    <button class="nav-btn" onclick="showPage('homePage')" aria-label="Go to Home">Home</button>
    <button class="nav-btn" onclick="showPage('dashboard')" aria-label="Go to Dashboard">Dashboard</button>
    <button class="nav-btn" onclick="showPage('subjectsPage')" aria-label="Go to Subjects">Subjects</button>
    <button class="nav-btn" onclick="showPage('mindmap')" aria-label="Go to Mind Map">Mind Map</button>
    <button class="nav-btn" onclick="showPage('quizPage')" aria-label="Go to Quiz">Quiz</button>
    <button class="nav-btn" onclick="showPage('wsPage')" aria-label="Go to Worksheet">Worksheet</button>
    <button class="nav-btn teacher-only" onclick="showPage('managePage')" aria-label="Go to Teacher Panel">Teacher Panel</button>
    <button class="nav-btn" onclick="showPage('aiChatPage')" aria-label="Go to AI Chat Assistant">AI Chat</button>
  </nav>

  <div id="main">
    <section id="homePage" class="page active" tabindex="-1">
      <h1 id="welcomeUser">Welcome to STERLA</h1>
      <div id="welcomeBox" class="glass" role="region" aria-label="Welcome message and quick instructions">
        <div>
          <h2>Your learning companion</h2>
          <p>Choose a subject → pick a topic → get mindmap / quiz / worksheet!</p>
        </div>
        <img src="https://cdn-icons-png.flaticon.com/512/2942/2942943.png" alt="School Icon" />
      </div>
      <div style="margin-top: 18px;">
        <h3>Quick Subjects</h3>
        <div id="subjectsQuick"></div>
      </div>
    </section>

    <section id="dashboard" class="page" tabindex="-1">
      <h1>Dashboard</h1>
      <h2>Announcements</h2>
      <div class="announce">• Chemistry worksheet due Monday</div>
      <div class="announce">• Biology test next Friday</div>
      <div class="announce">• Math homework submission closes tonight</div>
    </section>

    <section id="subjectsPage" class="page" tabindex="-1">
      <h1>Select a Subject</h1>
      <div id="subjectsContainer"></div>
    </section>

    <section id="topicPage" class="page" tabindex="-1">
      <h1 id="topicTitle"></h1>
      <div id="topicButtons"></div>
    </section>

    <section id="mindmap" class="page" tabindex="-1">
      <h2>Flowchart Generator</h2>
      <label for="mmTopic">Select Topic:</label>
      <select id="mmTopic" aria-label="Select Topic for Mindmap"><option value="">Choose topic</option></select>
      <button onclick="loadFlowchart()" aria-label="Generate Flowchart">Generate Flowchart</button>
      <div id="flowArea">
        <svg id="flowSVG" width="2000" height="2000"></svg>
      </div>
    </section>

    <section id="quizPage" class="page" tabindex="-1">
      <h1>Quiz</h1>
      <div class="output-box" id="quizOutput"></div>
    </section>

    <section id="wsPage" class="page" tabindex="-1">
      <h1>Worksheet</h1>
      <div class="output-box" id="wsOutput"></div>
    </section>

    <section id="managePage" class="page teacher-only" tabindex="-1">
      <h1>Teacher Panel</h1>
      <p>Here you can upload worksheets, add quizzes, view submissions, manage announcements.</p>
    </section>

    <section id="aiChatPage" class="page" tabindex="-1">
      <h1>AI Chat Assistant</h1>
      <div id="chatBox" aria-live="polite" aria-atomic="true"></div>
      <input type="text" id="chatInput" placeholder="Ask me anything..." aria-label="Chat input" />
      <button id="chatBtn" aria-label="Send chat message">Send</button>
    </section>
  </div>
</div>

<script>
  window.onload = function() {
    if(confirm("Do you want to see our paid promotion?")){
      alert("Thank you for your interest! Visit our sponsor for awesome deals.");
    }
    loadSubjects();
  };

  const loginPage = document.getElementById("loginPage");
  const appPage = document.getElementById("appPage");
  const emailInput = document.getElementById("email");
  const passcodeInput = document.getElementById("passcode");
  const loginMsg = document.getElementById("loginMessage");
  const subjectsQuick = document.getElementById("subjectsQuick");
  const topicTitle = document.getElementById("topicTitle");
  const topicButtons = document.getElementById("topicButtons");
  const chatBtn = document.getElementById("chatBtn");
  const chatInput = document.getElementById("chatInput");
  const chatBox = document.getElementById("chatBox");
  const mmTopicSelect = document.getElementById("mmTopic");
  const svgContainer = document.getElementById("flowSVG");
  const diagramTitle = document.querySelector("#mindmap h2");
  const welcomeUser = document.getElementById("welcomeUser");

  let selectedSubject = "";
  let chosenTopic = "";

  function login() {
    const email = emailInput.value.trim();
    const passcode = passcodeInput.value.trim();
    if(!email || !passcode){
      loginMsg.textContent = "Please enter both email and passcode.";
      loginMsg.style.color = "red";
      return;
    }
    // Example simple auth
    if(email === "admin@example.com" && passcode === "1234"){
      loginMsg.textContent = "Login successful!";
      loginMsg.style.color = "lightgreen";
      loginPage.style.display = "none";
      appPage.style.display = "flex";
      welcomeUser.textContent = "Welcome, " + email;
    } else {
      loginMsg.textContent = "Invalid email or passcode.";
      loginMsg.style.color = "red";
    }
  }

  function loadSubjects(){
    const box = document.getElementById("subjectsContainer");
    box.innerHTML = "";
    subjectsQuick.innerHTML = "";
    for(const sub in subjectTopics){
      box.innerHTML += `<div class="subject-card" onclick="selectSubject('${sub}')">${sub}</div>`;
      subjectsQuick.innerHTML += `<button class="topic-btn" onclick="selectSubject('${sub}')">${sub}</button>`;
    }
  }

  function selectSubject(sub){
    selectedSubject = sub;
    chosenTopic = "";
    showPage("topicPage");
    topicTitle.textContent = sub + " Topics";
    renderTopicButtons();
  }

  function renderTopicButtons(){
    if(!selectedSubject) return;
    let html = "";
    subjectTopics[selectedSubject].forEach(tp=>{
      html+=`<button class="topic-btn" onclick="setTopic('${tp}')">${tp}</button>`;
    });
    topicButtons.innerHTML = html;
  }
  
  function setTopic(tp){
    chosenTopic = tp;
    populateMindmapTopics();
    showPage("mindmap");
    showToast("Topic selected: " + tp);
  }

  function populateMindmapTopics(){
    mmTopicSelect.innerHTML = '<option value="">Choose topic</option>';
    if(selectedSubject && subjectTopics[selectedSubject]){
      subjectTopics[selectedSubject].forEach(t=>{
        let selected = (t === chosenTopic) ? "selected" : "";
        mmTopicSelect.innerHTML += `<option value="${t}" ${selected}>${t}</option>`;
      });
    }
  }

  function loadFlowchart(){
    const topic = mmTopicSelect.value || chosenTopic;
    if(!topic){
      alert("Please select a topic first.");
      return;
    }
    const data = (detailedFlowData[selectedSubject] && detailedFlowData[selectedSubject][topic]) || [];
    if(data.length === 0){
      alert("No flowchart data for this topic.");
      return;
    }
    svgContainer.innerHTML = "";
    diagramTitle.textContent = selectedSubject + " - " + topic + " Flowchart";
    const boxW = 250, boxH = 70, gapV = 60, startX = 150;
    data.forEach((text,i) => {
      const y = i*(boxH+gapV)+20;
      let rect = document.createElementNS("http://www.w3.org/2000/svg","rect");
      rect.setAttribute("x", startX); rect.setAttribute("y", y);
      rect.setAttribute("width", boxW); rect.setAttribute("height", boxH);
      rect.setAttribute("fill", "#574b90");
      rect.setAttribute("stroke", "#8a7cc1");
      rect.setAttribute("rx", "12"); rect.setAttribute("ry","12");
      svgContainer.appendChild(rect);

      let txt = document.createElementNS("http://www.w3.org/2000/svg","text");
      txt.textContent = text;
      txt.setAttribute("x", startX + boxW/2);
      txt.setAttribute("y", y + boxH/2 + 6);
      txt.setAttribute("font-family","Poppins, sans-serif");
      txt.setAttribute("text-anchor","middle");
      txt.setAttribute("fill","white");
      txt.setAttribute("font-size","16");
      svgContainer.appendChild(txt);

      if(i<data.length-1){
        let line = document.createElementNS("http://www.w3.org/2000/svg","line");
        line.setAttribute("x1", startX + boxW/2);
        line.setAttribute("y1", y + boxH);
        line.setAttribute("x2", startX + boxW/2);
        line.setAttribute("y2", y + boxH + gapV - 24);
        line.setAttribute("stroke", "#8a7cc1");
        line.setAttribute("stroke-width", 4);
        svgContainer
